import com.github.javaparser.ast.CompilationUnit;
import graph.MyGraph;
import graph.creation.ByClassOrInterfaceType;
import graph.creation.ByMethodCallInvocation;
import metrics.CHD;
import metrics.CHM;
import metrics.IRN;
import metrics.Metric;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

import parser.Parser;
import utils.StringUtils;

import java.io.IOException;
import java.nio.file.Path;
import java.util.List;
import java.util.Map;

public class MetricsTest {

    /*
        Projects
    */

    /*
        Cohesion at Message Level (CHM)
    */

    private static String PROJECTS_ROOT;

    @BeforeAll
    public static void checkEnv() {
        if (System.getenv("CI") == null) {
            PROJECTS_ROOT = "/home/mbrito/git/thesis-web-applications/monoliths";
        } else {
            PROJECTS_ROOT = System.getenv("GITHUB_WORKSPACE") + "/thesis-web-applications/monoliths";
        }
    }

    public double CHMProjectTest(String clusters, String path) throws IOException {
        List<CompilationUnit> compilationUnits = new Parser().parseProject(Path.of(path));
        Map<String, Integer> mapClusters = StringUtils.readClustersFromString(clusters);

        System.out.println("Path: " + path);
        System.out.println("Clusters <class, clusterId>:" + mapClusters);
        System.out.println("Number of classes: " + mapClusters.size());

        MyGraph graphReference = new ByClassOrInterfaceType(compilationUnits);
        Metric CHM = new CHM(graphReference);
        double chm = CHM.calculateCluster(mapClusters);
        System.out.println("CHM Project: " + chm);
        return chm;
    }


    @Test
    public void CHMSpringPetClinic() throws IOException {
        String clusters = "[['FailedToLoadPackageName.MavenWrapperDownloader'], ['org.springframework.samples.petclinic.vet.Specialty', 'org.springframework.samples.petclinic.vet.Vets', 'org.springframework.samples.petclinic.vet.Vet', 'org.springframework.samples.petclinic.vet.VetRepository', 'org.springframework.samples.petclinic.vet.VetController', 'org.springframework.samples.petclinic.PetclinicIntegrationTests', 'org.springframework.samples.petclinic.vet.VetTests', 'org.springframework.samples.petclinic.vet.VetControllerTests'], ['org.springframework.samples.petclinic.model.NamedEntity', 'org.springframework.samples.petclinic.model.Person', 'org.springframework.samples.petclinic.model.BaseEntity', 'org.springframework.samples.petclinic.service.EntityUtils', 'org.springframework.samples.petclinic.model.ValidatorTests'], ['org.springframework.samples.petclinic.system.CrashController', 'org.springframework.samples.petclinic.system.CrashControllerTests'], ['org.springframework.samples.petclinic.system.WelcomeController'], ['org.springframework.samples.petclinic.system.CacheConfiguration'], ['org.springframework.samples.petclinic.visit.VisitRepository', 'org.springframework.samples.petclinic.visit.Visit', 'org.springframework.samples.petclinic.owner.VisitController', 'org.springframework.samples.petclinic.service.ClinicServiceTests', 'org.springframework.samples.petclinic.owner.VisitControllerTests'], ['org.springframework.samples.petclinic.owner.OwnerRepository', 'org.springframework.samples.petclinic.owner.Owner', 'org.springframework.samples.petclinic.owner.OwnerController', 'org.springframework.samples.petclinic.owner.OwnerControllerTests'], ['org.springframework.samples.petclinic.owner.PetRepository', 'org.springframework.samples.petclinic.owner.PetType', 'org.springframework.samples.petclinic.owner.Pet', 'org.springframework.samples.petclinic.owner.PetTypeFormatter', 'org.springframework.samples.petclinic.owner.PetValidator', 'org.springframework.samples.petclinic.owner.PetController', 'org.springframework.samples.petclinic.owner.PetControllerTests', 'org.springframework.samples.petclinic.owner.PetTypeFormatterTests']]";
        String path = PROJECTS_ROOT + "/spring-petclinic";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.876, 0.01);
    }

    @Test
    public void CHMSpringPetClinicSingleClusters() throws IOException {
        String clusters = "[['FailedToLoadPackageName.MavenWrapperDownloader', 'org.springframework.samples.petclinic.vet.Specialty', 'org.springframework.samples.petclinic.vet.Vets', 'org.springframework.samples.petclinic.vet.Vet', 'org.springframework.samples.petclinic.vet.VetRepository', 'org.springframework.samples.petclinic.vet.VetController', 'org.springframework.samples.petclinic.PetclinicIntegrationTests', 'org.springframework.samples.petclinic.vet.VetTests', 'org.springframework.samples.petclinic.vet.VetControllerTests', 'org.springframework.samples.petclinic.model.NamedEntity', 'org.springframework.samples.petclinic.model.Person', 'org.springframework.samples.petclinic.model.BaseEntity', 'org.springframework.samples.petclinic.service.EntityUtils', 'org.springframework.samples.petclinic.model.ValidatorTests', 'org.springframework.samples.petclinic.system.CrashController', 'org.springframework.samples.petclinic.system.CrashControllerTests', 'org.springframework.samples.petclinic.system.WelcomeController', 'org.springframework.samples.petclinic.system.CacheConfiguration', 'org.springframework.samples.petclinic.visit.VisitRepository', 'org.springframework.samples.petclinic.visit.Visit', 'org.springframework.samples.petclinic.owner.VisitController', 'org.springframework.samples.petclinic.service.ClinicServiceTests', 'org.springframework.samples.petclinic.owner.VisitControllerTests', 'org.springframework.samples.petclinic.owner.OwnerRepository', 'org.springframework.samples.petclinic.owner.Owner', 'org.springframework.samples.petclinic.owner.OwnerController', 'org.springframework.samples.petclinic.owner.OwnerControllerTests', 'org.springframework.samples.petclinic.owner.PetRepository', 'org.springframework.samples.petclinic.owner.PetType', 'org.springframework.samples.petclinic.owner.Pet', 'org.springframework.samples.petclinic.owner.PetTypeFormatter', 'org.springframework.samples.petclinic.owner.PetValidator', 'org.springframework.samples.petclinic.owner.PetController', 'org.springframework.samples.petclinic.owner.PetControllerTests', 'org.springframework.samples.petclinic.owner.PetTypeFormatterTests']]";
        String path = PROJECTS_ROOT + "/spring-petclinic";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.889, 0.01);
    }

    @Test
    public void CHMSpringBlog() throws IOException {

        String clusters = "[['com.raysmond.blog.JpaConfig', 'com.raysmond.blog.Application'], ['com.raysmond.blog.Constants'], ['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.utils.PaginatorUtil'], ['com.raysmond.blog.utils.DTOUtil'], ['com.raysmond.blog.utils.CommonHelper'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.models.Post', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.support.web.HttpContentTypeSerializer'], ['com.raysmond.blog.support.web.Message', 'com.raysmond.blog.support.web.MessageHelper'], ['com.raysmond.blog.support.web.extensions.YouTubeLinkExtension'], ['com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.support.FailedToLoadClassName'], ['com.raysmond.blog.models.dto.VisitStatDTO'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController'], ['com.raysmond.blog.services.SeoRobotAgentService']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.889, 0.001);
    }

    @Test
    public void CHMSpringBlogClustersBiggerThan2Classes() throws IOException {
        String clusters = "[['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController'], ['com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.models.Post', 'com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.831, 0.001);
    }

    @Test
    public void CHMMonoMusic() throws IOException {

        String clusters = "[['de.infonautika.monomusiccorp.app.ApplicationSecurity', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethodRegistry', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.MethodCuriProvider', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManager', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManagerImpl', 'de.infonautika.monomusiccorp.app.controller.ResourceNotFoundException', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.CuriInfo', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethod', 'de.infonautika.monomusiccorp.app.security.DefaultUsers', 'de.infonautika.monomusiccorp.app.security.MutableUserDetails', 'de.infonautika.monomusiccorp.app.security.SecurityServiceImpl', 'de.infonautika.monomusiccorp.app.business.errors.ConflictException'], ['de.infonautika.monomusiccorp.app.business.ApplicationState', 'de.infonautika.monomusiccorp.app.controller.CatalogController', 'de.infonautika.monomusiccorp.app.repository.ProductLookup', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResource', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Product', 'de.infonautika.monomusiccorp.app.controller.StockController', 'de.infonautika.monomusiccorp.app.repository.StockItemRepository', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResource', 'de.infonautika.monomusiccorp.app.domain.StockItem', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResourceAssembler', 'de.infonautika.monomusiccorp.app.repository.ProductRepository', 'de.infonautika.monomusiccorp.app.repository.ProductLookupImpl', 'de.infonautika.monomusiccorp.app.controller.StockControllerTest'], ['de.infonautika.monomusiccorp.app.util.VoidOptional'], ['de.infonautika.monomusiccorp.app.controller.utils.AuthorizedInvocationFilter', 'de.infonautika.monomusiccorp.app.controller.utils.links.Invocation', 'de.infonautika.monomusiccorp.app.controller.InfoController', 'de.infonautika.monomusiccorp.app.controller.resources.MessageResource', 'de.infonautika.monomusiccorp.app.controller.UserController', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacade', 'de.infonautika.monomusiccorp.app.controller.utils.LinkSupport', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkCreator', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkFacade', 'de.infonautika.monomusiccorp.app.controller.utils.links.InvocationInterceptor', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacadeImpl', 'de.infonautika.monomusiccorp.app.controller.CatalogControllerTest', 'de.infonautika.monomusiccorp.app.controller.UserControllerTest', 'de.infonautika.monomusiccorp.app.controller.utils.DummyController', 'de.infonautika.monomusiccorp.app.controller.utils.links.MyController'], ['de.infonautika.monomusiccorp.app.controller.ShoppingController', 'de.infonautika.monomusiccorp.app.business.BusinessProcess', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProvider', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Customer', 'de.infonautika.monomusiccorp.app.repository.CustomerLookup', 'de.infonautika.monomusiccorp.app.controller.CustomerController', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResource', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResourceAssembler', 'de.infonautika.monomusiccorp.app.business.CustomerInfo', 'de.infonautika.monomusiccorp.app.domain.Address', 'de.infonautika.monomusiccorp.app.repository.CustomerRepository', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImpl', 'de.infonautika.monomusiccorp.app.repository.CustomerLookupImpl', 'de.infonautika.monomusiccorp.app.controller.CustomerControllerTest', 'de.infonautika.monomusiccorp.app.controller.ShoppingControllerTest', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImplTest'], ['de.infonautika.monomusiccorp.app.domain.Position', 'de.infonautika.monomusiccorp.app.domain.PricedPosition', 'de.infonautika.monomusiccorp.app.domain.Money', 'de.infonautika.monomusiccorp.app.security.SecurityService', 'de.infonautika.monomusiccorp.app.business.InvoiceDelivery', 'de.infonautika.monomusiccorp.app.domain.Invoice', 'de.infonautika.monomusiccorp.app.business.DummyInvoiceDeliveryImpl', 'de.infonautika.monomusiccorp.app.business.BusinessProcessImpl', 'de.infonautika.monomusiccorp.app.repository.OrderRepository', 'de.infonautika.monomusiccorp.app.repository.ShoppingBasketRepository', 'de.infonautika.monomusiccorp.app.repository.InvoiceRepository', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasket', 'de.infonautika.monomusiccorp.app.domain.Order', 'de.infonautika.monomusiccorp.app.domain.HasPositions', 'de.infonautika.monomusiccorp.app.domain.HasPricedPositions', 'de.infonautika.monomusiccorp.app.business.StateSetup', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasketTest'], ['de.infonautika.monomusiccorp.app.business.errors.ForbiddenException', 'de.infonautika.monomusiccorp.app.controller.OrdersController', 'de.infonautika.monomusiccorp.app.repository.PickingOrderRepository', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResource', 'de.infonautika.monomusiccorp.app.business.errors.DoesNotExistException', 'de.infonautika.monomusiccorp.app.domain.PickingOrder', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResourceAssembler', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResourceAssembler', 'de.infonautika.monomusiccorp.app.business.StockNotification', 'de.infonautika.monomusiccorp.app.business.DummyStockNotificationImpl', 'de.infonautika.monomusiccorp.app.business.errors.BusinessError', 'de.infonautika.monomusiccorp.app.controller.OrdersControllerTest'], ['de.infonautika.monomusiccorp.app.controller.utils.Results'], ['de.infonautika.monomusiccorp.app.controller.utils.links.FailedToLoadClassName'], ['de.infonautika.monomusiccorp.app.security.UserRole'], ['de.infonautika.monomusiccorp.app.persist.LocalDateTimeConverter'], ['de.infonautika.monomusiccorp.app.domain.Currencies'], ['de.infonautika.monomusiccorp.app.JsonTesterRule'], ['de.infonautika.monomusiccorp.app.DescribingMatcherBuilder', 'de.infonautika.monomusiccorp.app.BiDescribingMatcher', 'de.infonautika.monomusiccorp.app.BiDescribingMatcherBuilder'], ['de.infonautika.monomusiccorp.app.controller.ControllerConstants'], ['de.infonautika.monomusiccorp.app.controller.MatcherDebug']]";
        String path = PROJECTS_ROOT + "/monomusiccorp";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.876, 0.001);
    }

    @Test
    public void CHMTest() throws IOException {

        String clusters = "[['com.test.Main', 'com.test.OtherClass'], ['com.test.ClassB']]";
        String path = PROJECTS_ROOT + "/test";

        double chm = CHMProjectTest(clusters, path);
        assertEquals(chm, 0.75, 0.01);
    }


    /*
    --------------------------------------------------------------------------------------------
    --------------------------------------------------------------------------------------------
    */

    /*
        Cohesion at Domain Level (CHD)
    */

    public double CHDProjectTest(String clusters, String path) throws IOException {
        List<CompilationUnit> compilationUnits = new Parser().parseProject(Path.of(path));
        Map<String, Integer> mapClusters = StringUtils.readClustersFromString(clusters);

        MyGraph graphReference = new ByClassOrInterfaceType(compilationUnits);
        Metric CHD = new CHD(graphReference);
        double chd = CHD.calculateCluster(mapClusters);
        System.out.println("CHD Project: " + chd);
        return chd;
    }


    @Test
    public void CHDSpringPetClinic() throws IOException {
        String clusters = "[['FailedToLoadPackageName.MavenWrapperDownloader'], ['org.springframework.samples.petclinic.vet.Specialty', 'org.springframework.samples.petclinic.vet.Vets', 'org.springframework.samples.petclinic.vet.Vet', 'org.springframework.samples.petclinic.vet.VetRepository', 'org.springframework.samples.petclinic.vet.VetController', 'org.springframework.samples.petclinic.PetclinicIntegrationTests', 'org.springframework.samples.petclinic.vet.VetTests', 'org.springframework.samples.petclinic.vet.VetControllerTests'], ['org.springframework.samples.petclinic.model.NamedEntity', 'org.springframework.samples.petclinic.model.Person', 'org.springframework.samples.petclinic.model.BaseEntity', 'org.springframework.samples.petclinic.service.EntityUtils', 'org.springframework.samples.petclinic.model.ValidatorTests'], ['org.springframework.samples.petclinic.system.CrashController', 'org.springframework.samples.petclinic.system.CrashControllerTests'], ['org.springframework.samples.petclinic.system.WelcomeController'], ['org.springframework.samples.petclinic.system.CacheConfiguration'], ['org.springframework.samples.petclinic.visit.VisitRepository', 'org.springframework.samples.petclinic.visit.Visit', 'org.springframework.samples.petclinic.owner.VisitController', 'org.springframework.samples.petclinic.service.ClinicServiceTests', 'org.springframework.samples.petclinic.owner.VisitControllerTests'], ['org.springframework.samples.petclinic.owner.OwnerRepository', 'org.springframework.samples.petclinic.owner.Owner', 'org.springframework.samples.petclinic.owner.OwnerController', 'org.springframework.samples.petclinic.owner.OwnerControllerTests'], ['org.springframework.samples.petclinic.owner.PetRepository', 'org.springframework.samples.petclinic.owner.PetType', 'org.springframework.samples.petclinic.owner.Pet', 'org.springframework.samples.petclinic.owner.PetTypeFormatter', 'org.springframework.samples.petclinic.owner.PetValidator', 'org.springframework.samples.petclinic.owner.PetController', 'org.springframework.samples.petclinic.owner.PetControllerTests', 'org.springframework.samples.petclinic.owner.PetTypeFormatterTests']]";
        String path = PROJECTS_ROOT + "/spring-petclinic";

        double chd = CHDProjectTest(clusters, path);
        assertEquals(chd, 0.889, 0.01);
    }


    @Test
    public void CHDSpringBlog() throws IOException {

        String clusters = "[['com.raysmond.blog.JpaConfig', 'com.raysmond.blog.Application'], ['com.raysmond.blog.Constants'], ['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.utils.PaginatorUtil'], ['com.raysmond.blog.utils.DTOUtil'], ['com.raysmond.blog.utils.CommonHelper'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.models.Post', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.support.web.HttpContentTypeSerializer'], ['com.raysmond.blog.support.web.Message', 'com.raysmond.blog.support.web.MessageHelper'], ['com.raysmond.blog.support.web.extensions.YouTubeLinkExtension'], ['com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.support.FailedToLoadClassName'], ['com.raysmond.blog.models.dto.VisitStatDTO'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController'], ['com.raysmond.blog.services.SeoRobotAgentService']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double chd = CHDProjectTest(clusters, path);
        assertEquals(chd, 0.919, 0.001);
    }

    @Test
    public void CHDSpringBlogClustersBiggerThan2Classes() throws IOException {
        String clusters = "[['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController'], ['com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.models.Post', 'com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double chd = CHDProjectTest(clusters, path);
        assertEquals(chd, 0.884, 0.001);
    }

    @Test
    public void CHDMonoMusic() throws IOException {

        String clusters = "[['de.infonautika.monomusiccorp.app.ApplicationSecurity', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethodRegistry', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.MethodCuriProvider', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManager', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManagerImpl', 'de.infonautika.monomusiccorp.app.controller.ResourceNotFoundException', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.CuriInfo', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethod', 'de.infonautika.monomusiccorp.app.security.DefaultUsers', 'de.infonautika.monomusiccorp.app.security.MutableUserDetails', 'de.infonautika.monomusiccorp.app.security.SecurityServiceImpl', 'de.infonautika.monomusiccorp.app.business.errors.ConflictException'], ['de.infonautika.monomusiccorp.app.business.ApplicationState', 'de.infonautika.monomusiccorp.app.controller.CatalogController', 'de.infonautika.monomusiccorp.app.repository.ProductLookup', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResource', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Product', 'de.infonautika.monomusiccorp.app.controller.StockController', 'de.infonautika.monomusiccorp.app.repository.StockItemRepository', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResource', 'de.infonautika.monomusiccorp.app.domain.StockItem', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResourceAssembler', 'de.infonautika.monomusiccorp.app.repository.ProductRepository', 'de.infonautika.monomusiccorp.app.repository.ProductLookupImpl', 'de.infonautika.monomusiccorp.app.controller.StockControllerTest'], ['de.infonautika.monomusiccorp.app.util.VoidOptional'], ['de.infonautika.monomusiccorp.app.controller.utils.AuthorizedInvocationFilter', 'de.infonautika.monomusiccorp.app.controller.utils.links.Invocation', 'de.infonautika.monomusiccorp.app.controller.InfoController', 'de.infonautika.monomusiccorp.app.controller.resources.MessageResource', 'de.infonautika.monomusiccorp.app.controller.UserController', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacade', 'de.infonautika.monomusiccorp.app.controller.utils.LinkSupport', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkCreator', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkFacade', 'de.infonautika.monomusiccorp.app.controller.utils.links.InvocationInterceptor', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacadeImpl', 'de.infonautika.monomusiccorp.app.controller.CatalogControllerTest', 'de.infonautika.monomusiccorp.app.controller.UserControllerTest', 'de.infonautika.monomusiccorp.app.controller.utils.DummyController', 'de.infonautika.monomusiccorp.app.controller.utils.links.MyController'], ['de.infonautika.monomusiccorp.app.controller.ShoppingController', 'de.infonautika.monomusiccorp.app.business.BusinessProcess', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProvider', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Customer', 'de.infonautika.monomusiccorp.app.repository.CustomerLookup', 'de.infonautika.monomusiccorp.app.controller.CustomerController', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResource', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResourceAssembler', 'de.infonautika.monomusiccorp.app.business.CustomerInfo', 'de.infonautika.monomusiccorp.app.domain.Address', 'de.infonautika.monomusiccorp.app.repository.CustomerRepository', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImpl', 'de.infonautika.monomusiccorp.app.repository.CustomerLookupImpl', 'de.infonautika.monomusiccorp.app.controller.CustomerControllerTest', 'de.infonautika.monomusiccorp.app.controller.ShoppingControllerTest', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImplTest'], ['de.infonautika.monomusiccorp.app.domain.Position', 'de.infonautika.monomusiccorp.app.domain.PricedPosition', 'de.infonautika.monomusiccorp.app.domain.Money', 'de.infonautika.monomusiccorp.app.security.SecurityService', 'de.infonautika.monomusiccorp.app.business.InvoiceDelivery', 'de.infonautika.monomusiccorp.app.domain.Invoice', 'de.infonautika.monomusiccorp.app.business.DummyInvoiceDeliveryImpl', 'de.infonautika.monomusiccorp.app.business.BusinessProcessImpl', 'de.infonautika.monomusiccorp.app.repository.OrderRepository', 'de.infonautika.monomusiccorp.app.repository.ShoppingBasketRepository', 'de.infonautika.monomusiccorp.app.repository.InvoiceRepository', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasket', 'de.infonautika.monomusiccorp.app.domain.Order', 'de.infonautika.monomusiccorp.app.domain.HasPositions', 'de.infonautika.monomusiccorp.app.domain.HasPricedPositions', 'de.infonautika.monomusiccorp.app.business.StateSetup', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasketTest'], ['de.infonautika.monomusiccorp.app.business.errors.ForbiddenException', 'de.infonautika.monomusiccorp.app.controller.OrdersController', 'de.infonautika.monomusiccorp.app.repository.PickingOrderRepository', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResource', 'de.infonautika.monomusiccorp.app.business.errors.DoesNotExistException', 'de.infonautika.monomusiccorp.app.domain.PickingOrder', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResourceAssembler', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResourceAssembler', 'de.infonautika.monomusiccorp.app.business.StockNotification', 'de.infonautika.monomusiccorp.app.business.DummyStockNotificationImpl', 'de.infonautika.monomusiccorp.app.business.errors.BusinessError', 'de.infonautika.monomusiccorp.app.controller.OrdersControllerTest'], ['de.infonautika.monomusiccorp.app.controller.utils.Results'], ['de.infonautika.monomusiccorp.app.controller.utils.links.FailedToLoadClassName'], ['de.infonautika.monomusiccorp.app.security.UserRole'], ['de.infonautika.monomusiccorp.app.persist.LocalDateTimeConverter'], ['de.infonautika.monomusiccorp.app.domain.Currencies'], ['de.infonautika.monomusiccorp.app.JsonTesterRule'], ['de.infonautika.monomusiccorp.app.DescribingMatcherBuilder', 'de.infonautika.monomusiccorp.app.BiDescribingMatcher', 'de.infonautika.monomusiccorp.app.BiDescribingMatcherBuilder'], ['de.infonautika.monomusiccorp.app.controller.ControllerConstants'], ['de.infonautika.monomusiccorp.app.controller.MatcherDebug']]";
        String path = PROJECTS_ROOT + "/monomusiccorp";


        double chd = CHDProjectTest(clusters, path);
        assertEquals(chd, 0.837, 0.001);
    }

    @Test
    public void CHDTest() throws IOException {

        String clusters = "[['com.test.Main', 'com.test.OtherClass'], ['com.test.ClassB']]";
        String path = PROJECTS_ROOT + "/test";

        double chd = CHDProjectTest(clusters, path);
        assertEquals(chd, 1.0, 0.01);
    }



    /*
    --------------------------------------------------------------------------------------------
    --------------------------------------------------------------------------------------------
    */

    /*
        Interaction Number (IRN)
    */

    public double IRNProjectTest(String clusters, String path) throws IOException {
        List<CompilationUnit> compilationUnits = new Parser().parseProject(Path.of(path));
        Map<String, Integer> mapClusters = StringUtils.readClustersFromString(clusters);

        MyGraph graphReference = new ByMethodCallInvocation(compilationUnits);
        Metric IRN = new IRN(graphReference);
        double irn = IRN.calculateCluster(mapClusters);
        System.out.println("IRN Project: " + irn);
        return irn;
    }


    @Test
    public void IRNSpringPetClinic() throws IOException {
        String clusters = "[['FailedToLoadPackageName.MavenWrapperDownloader'], ['org.springframework.samples.petclinic.vet.Specialty', 'org.springframework.samples.petclinic.vet.Vets', 'org.springframework.samples.petclinic.vet.Vet', 'org.springframework.samples.petclinic.vet.VetRepository', 'org.springframework.samples.petclinic.vet.VetController', 'org.springframework.samples.petclinic.PetclinicIntegrationTests', 'org.springframework.samples.petclinic.vet.VetTests', 'org.springframework.samples.petclinic.vet.VetControllerTests'], ['org.springframework.samples.petclinic.model.NamedEntity', 'org.springframework.samples.petclinic.model.Person', 'org.springframework.samples.petclinic.model.BaseEntity', 'org.springframework.samples.petclinic.service.EntityUtils', 'org.springframework.samples.petclinic.model.ValidatorTests'], ['org.springframework.samples.petclinic.system.CrashController', 'org.springframework.samples.petclinic.system.CrashControllerTests'], ['org.springframework.samples.petclinic.system.WelcomeController'], ['org.springframework.samples.petclinic.system.CacheConfiguration'], ['org.springframework.samples.petclinic.visit.VisitRepository', 'org.springframework.samples.petclinic.visit.Visit', 'org.springframework.samples.petclinic.owner.VisitController', 'org.springframework.samples.petclinic.service.ClinicServiceTests', 'org.springframework.samples.petclinic.owner.VisitControllerTests'], ['org.springframework.samples.petclinic.owner.OwnerRepository', 'org.springframework.samples.petclinic.owner.Owner', 'org.springframework.samples.petclinic.owner.OwnerController', 'org.springframework.samples.petclinic.owner.OwnerControllerTests'], ['org.springframework.samples.petclinic.owner.PetRepository', 'org.springframework.samples.petclinic.owner.PetType', 'org.springframework.samples.petclinic.owner.Pet', 'org.springframework.samples.petclinic.owner.PetTypeFormatter', 'org.springframework.samples.petclinic.owner.PetValidator', 'org.springframework.samples.petclinic.owner.PetController', 'org.springframework.samples.petclinic.owner.PetControllerTests', 'org.springframework.samples.petclinic.owner.PetTypeFormatterTests']]";
        String path = PROJECTS_ROOT + "/spring-petclinic";

        double irn = IRNProjectTest(clusters, path);
        assertEquals(irn, 20);
    }


    @Test
    public void IRNSpringBlog() throws IOException {

        String clusters = "[['com.raysmond.blog.JpaConfig', 'com.raysmond.blog.Application'], ['com.raysmond.blog.Constants'], ['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.utils.PaginatorUtil'], ['com.raysmond.blog.utils.DTOUtil'], ['com.raysmond.blog.utils.CommonHelper'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.models.Post', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.support.web.HttpContentTypeSerializer'], ['com.raysmond.blog.support.web.Message', 'com.raysmond.blog.support.web.MessageHelper'], ['com.raysmond.blog.support.web.extensions.YouTubeLinkExtension'], ['com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.support.FailedToLoadClassName'], ['com.raysmond.blog.models.dto.VisitStatDTO'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController'], ['com.raysmond.blog.services.SeoRobotAgentService']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double irn = IRNProjectTest(clusters, path);
        assertEquals(irn, 45);
    }

    @Test
    public void IRNSpringBlogClustersBiggerThan2Classes() throws IOException {
        String clusters = "[['com.raysmond.blog.WebConfig', 'com.raysmond.blog.support.web.ViewHelper', 'com.raysmond.blog.models.support.WebError', 'com.raysmond.blog.forms.LikeForm', 'com.raysmond.blog.controllers.SympathyRequestData', 'com.raysmond.blog.services.RequestProcessorService'], ['com.raysmond.blog.SecurityConfig', 'com.raysmond.blog.services.UserService', 'com.raysmond.blog.repositories.StoredFileRepository', 'com.raysmond.blog.models.StoredFile', 'com.raysmond.blog.repositories.UserRepository', 'com.raysmond.blog.forms.StoredFileForm', 'com.raysmond.blog.forms.UserForm', 'com.raysmond.blog.admin.controllers.StoredFileController', 'com.raysmond.blog.services.FileStorageService', 'com.raysmond.blog.admin.controllers.UserController'], ['com.raysmond.blog.support.web.SyntaxHighlightService', 'com.raysmond.blog.support.web.FlexmarkMarkdownService', 'com.raysmond.blog.support.web.MarkdownService', 'com.raysmond.blog.forms.PostPreviewForm', 'com.raysmond.blog.forms.PostForm', 'com.raysmond.blog.models.dto.PostPreviewDTO', 'com.raysmond.blog.admin.controllers.PostController'], ['com.raysmond.blog.services.AppSetting', 'com.raysmond.blog.repositories.SettingRepository', 'com.raysmond.blog.models.Setting', 'com.raysmond.blog.notificators.Notificator', 'com.raysmond.blog.notificators.telegram.TelegramBot', 'com.raysmond.blog.services.TelegramBotSettings', 'com.raysmond.blog.seo.controllers.SitemapController', 'com.raysmond.blog.services.SeoService', 'com.raysmond.blog.forms.SettingsForm', 'com.raysmond.blog.models.dto.PostAnnouncementDTO', 'com.raysmond.blog.models.dto.AjaxAnswerDTO', 'com.raysmond.blog.services.CacheSettingService', 'com.raysmond.blog.services.SettingService', 'com.raysmond.blog.admin.controllers.AdminController', 'com.raysmond.blog.admin.controllers.NotificatorController'], ['com.raysmond.blog.models.Post', 'com.raysmond.blog.repositories.SeoRobotAgentRepository', 'com.raysmond.blog.models.SeoRobotAgent', 'com.raysmond.blog.repositories.VisitRepository', 'com.raysmond.blog.models.Visit', 'com.raysmond.blog.models.User', 'com.raysmond.blog.repositories.LikeRepository', 'com.raysmond.blog.models.Like', 'com.raysmond.blog.forms.SeoRobotAgentForm', 'com.raysmond.blog.models.BaseModel', 'com.raysmond.blog.services.LikeService', 'com.raysmond.blog.services.VisitService', 'com.raysmond.blog.admin.controllers.SeoRobotAgentController'], ['com.raysmond.blog.repositories.TagRepository', 'com.raysmond.blog.models.Tag', 'com.raysmond.blog.repositories.SeoPostDataRepository', 'com.raysmond.blog.models.SeoPostData', 'com.raysmond.blog.repositories.PostRepository', 'com.raysmond.blog.services.PostService', 'com.raysmond.blog.models.dto.PostIdTitleDTO', 'com.raysmond.blog.controllers.TagController', 'com.raysmond.blog.services.TagService', 'com.raysmond.blog.error.NotFoundException', 'com.raysmond.blog.controllers.HomeController', 'com.raysmond.blog.error.ExceptionHandlerController'], ['com.raysmond.blog.models.dto.PostsIdListDTO', 'com.raysmond.blog.models.dto.Series', 'com.raysmond.blog.services.StatisticsService', 'com.raysmond.blog.admin.controllers.StatisticsController']]";
        String path = PROJECTS_ROOT + "/spring-blog";

        double irn = IRNProjectTest(clusters, path);
        assertEquals(irn, 117);
    }

    @Test
    public void IRNMonoMusic() throws IOException {

        String clusters = "[['de.infonautika.monomusiccorp.app.ApplicationSecurity', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethodRegistry', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.MethodCuriProvider', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManager', 'de.infonautika.monomusiccorp.app.security.ModifiableUserDetailsManagerImpl', 'de.infonautika.monomusiccorp.app.controller.ResourceNotFoundException', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.CuriInfo', 'de.infonautika.monomusiccorp.app.controller.utils.links.curi.RelationMethod', 'de.infonautika.monomusiccorp.app.security.DefaultUsers', 'de.infonautika.monomusiccorp.app.security.MutableUserDetails', 'de.infonautika.monomusiccorp.app.security.SecurityServiceImpl', 'de.infonautika.monomusiccorp.app.business.errors.ConflictException'], ['de.infonautika.monomusiccorp.app.business.ApplicationState', 'de.infonautika.monomusiccorp.app.controller.CatalogController', 'de.infonautika.monomusiccorp.app.repository.ProductLookup', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResource', 'de.infonautika.monomusiccorp.app.controller.resources.ProductResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Product', 'de.infonautika.monomusiccorp.app.controller.StockController', 'de.infonautika.monomusiccorp.app.repository.StockItemRepository', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResource', 'de.infonautika.monomusiccorp.app.domain.StockItem', 'de.infonautika.monomusiccorp.app.controller.resources.StockItemResourceAssembler', 'de.infonautika.monomusiccorp.app.repository.ProductRepository', 'de.infonautika.monomusiccorp.app.repository.ProductLookupImpl', 'de.infonautika.monomusiccorp.app.controller.StockControllerTest'], ['de.infonautika.monomusiccorp.app.util.VoidOptional'], ['de.infonautika.monomusiccorp.app.controller.utils.AuthorizedInvocationFilter', 'de.infonautika.monomusiccorp.app.controller.utils.links.Invocation', 'de.infonautika.monomusiccorp.app.controller.InfoController', 'de.infonautika.monomusiccorp.app.controller.resources.MessageResource', 'de.infonautika.monomusiccorp.app.controller.UserController', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacade', 'de.infonautika.monomusiccorp.app.controller.utils.LinkSupport', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkCreator', 'de.infonautika.monomusiccorp.app.controller.utils.links.LinkFacade', 'de.infonautika.monomusiccorp.app.controller.utils.links.InvocationInterceptor', 'de.infonautika.monomusiccorp.app.security.AuthenticationFacadeImpl', 'de.infonautika.monomusiccorp.app.controller.CatalogControllerTest', 'de.infonautika.monomusiccorp.app.controller.UserControllerTest', 'de.infonautika.monomusiccorp.app.controller.utils.DummyController', 'de.infonautika.monomusiccorp.app.controller.utils.links.MyController'], ['de.infonautika.monomusiccorp.app.controller.ShoppingController', 'de.infonautika.monomusiccorp.app.business.BusinessProcess', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProvider', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PositionResourceAssembler', 'de.infonautika.monomusiccorp.app.domain.Customer', 'de.infonautika.monomusiccorp.app.repository.CustomerLookup', 'de.infonautika.monomusiccorp.app.controller.CustomerController', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResource', 'de.infonautika.monomusiccorp.app.controller.resources.CustomerResourceAssembler', 'de.infonautika.monomusiccorp.app.business.CustomerInfo', 'de.infonautika.monomusiccorp.app.domain.Address', 'de.infonautika.monomusiccorp.app.repository.CustomerRepository', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImpl', 'de.infonautika.monomusiccorp.app.repository.CustomerLookupImpl', 'de.infonautika.monomusiccorp.app.controller.CustomerControllerTest', 'de.infonautika.monomusiccorp.app.controller.ShoppingControllerTest', 'de.infonautika.monomusiccorp.app.intermediate.CurrentCustomerProviderImplTest'], ['de.infonautika.monomusiccorp.app.domain.Position', 'de.infonautika.monomusiccorp.app.domain.PricedPosition', 'de.infonautika.monomusiccorp.app.domain.Money', 'de.infonautika.monomusiccorp.app.security.SecurityService', 'de.infonautika.monomusiccorp.app.business.InvoiceDelivery', 'de.infonautika.monomusiccorp.app.domain.Invoice', 'de.infonautika.monomusiccorp.app.business.DummyInvoiceDeliveryImpl', 'de.infonautika.monomusiccorp.app.business.BusinessProcessImpl', 'de.infonautika.monomusiccorp.app.repository.OrderRepository', 'de.infonautika.monomusiccorp.app.repository.ShoppingBasketRepository', 'de.infonautika.monomusiccorp.app.repository.InvoiceRepository', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasket', 'de.infonautika.monomusiccorp.app.domain.Order', 'de.infonautika.monomusiccorp.app.domain.HasPositions', 'de.infonautika.monomusiccorp.app.domain.HasPricedPositions', 'de.infonautika.monomusiccorp.app.business.StateSetup', 'de.infonautika.monomusiccorp.app.domain.ShoppingBasketTest'], ['de.infonautika.monomusiccorp.app.business.errors.ForbiddenException', 'de.infonautika.monomusiccorp.app.controller.OrdersController', 'de.infonautika.monomusiccorp.app.repository.PickingOrderRepository', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResource', 'de.infonautika.monomusiccorp.app.business.errors.DoesNotExistException', 'de.infonautika.monomusiccorp.app.domain.PickingOrder', 'de.infonautika.monomusiccorp.app.controller.resources.OrderStatusResourceAssembler', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResource', 'de.infonautika.monomusiccorp.app.controller.resources.PricedPositionResourceAssembler', 'de.infonautika.monomusiccorp.app.business.StockNotification', 'de.infonautika.monomusiccorp.app.business.DummyStockNotificationImpl', 'de.infonautika.monomusiccorp.app.business.errors.BusinessError', 'de.infonautika.monomusiccorp.app.controller.OrdersControllerTest'], ['de.infonautika.monomusiccorp.app.controller.utils.Results'], ['de.infonautika.monomusiccorp.app.controller.utils.links.FailedToLoadClassName'], ['de.infonautika.monomusiccorp.app.security.UserRole'], ['de.infonautika.monomusiccorp.app.persist.LocalDateTimeConverter'], ['de.infonautika.monomusiccorp.app.domain.Currencies'], ['de.infonautika.monomusiccorp.app.JsonTesterRule'], ['de.infonautika.monomusiccorp.app.DescribingMatcherBuilder', 'de.infonautika.monomusiccorp.app.BiDescribingMatcher', 'de.infonautika.monomusiccorp.app.BiDescribingMatcherBuilder'], ['de.infonautika.monomusiccorp.app.controller.ControllerConstants'], ['de.infonautika.monomusiccorp.app.controller.MatcherDebug']]";
        String path = PROJECTS_ROOT + "/monomusiccorp";

        double irn = IRNProjectTest(clusters, path);
        assertEquals(irn, 82);
    }


    @Test
    public void IRNTest() throws IOException {

        String clusters = "[['com.test.Main', 'com.test.OtherClass'], ['com.test.ClassB']]";
        String path = PROJECTS_ROOT + "/test";

        double irn = IRNProjectTest(clusters, path);
        assertEquals(irn, 0);
    }


}
